function cacie_options_format_editable(e){var a=[];if("undefined"==typeof e)return a;for(var t=0;t<e.length;t++){var i;if("undefined"!=typeof e[t].options){i={text:e[t].label,children:[]};for(var c in e[t].options)i.children.push({value:e[t].options[c].value,id:e[t].options[c].value,text:e[t].options[c].label})}else i={value:e[t].value,id:e[t].value,text:e[t].label};a.push(i)}return a}function cacie_get_jquery_boostrap_date_format(e){return e=e.replace("yy","R"),e=e.replace("y","yy"),e=e.replace("R","yyyy")}function cacie_esc_regex(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function cacie_is_float(e){var a="";"decimal_point"in woocommerce_admin&&woocommerce_admin.decimal_point&&(a="|"+cacie_esc_regex(woocommerce_admin.decimal_point));var t=new RegExp("^[0-9]+((."+a+")[0-9]+)?$");return e.match(t)}function cacie_init(){window.xeditables=[],window.cacie_edit_enabled=1;var e=jQuery(CACIE_List_Selector),a=CACIE_Columns,t=CACIE_Items;for(var i in a){var c=a[i];if(c.column_name=i,"on"==c.edit&&c.addon_cacie.editable){if("undefined"==typeof c.addon_cacie.editable.type||""===c.addon_cacie.editable.type)continue;var n,d=c.addon_cacie.editable.type;n="cacie_edit_"+d,jQuery(".column-"+i,e).each(function(){var e,a=jQuery(this).parents("tr").attr("id"),o=parseInt(a.substr(a.lastIndexOf("-")+1),10);if(!(o in t))return!0;e=t[o];var l;if(i in e.columndata&&(l=e.columndata[i].revisions[0]),"undefined"==typeof l||"undefined"!=typeof l.errors)return!0;("select2_dropdown"==d||"select2_tags"==d)&&0===l.length&&(l=[]),e.columndata[i].value=l,jQuery(this).addClass("cacie-editable-container cacie-editable-"+d),jQuery(this).wrapInner('<span class="inner cacie-editable"></span>');var r=jQuery(this).find(".inner");r.cacie_handle_value(c,e),r.cacie_handle_actions(c,e),r[n](c,e)})}}}function cacie_enable(){jQuery("#cacie-toggle-edit").addClass("active"),"undefined"==typeof window.xeditables?cacie_init():jQuery(window.xeditables).editable("enable"),jQuery(CACIE_List_Selector).addClass("cacie-enabled"),window.cacie_edit_enabled=1}function cacie_disable(){jQuery("#cacie-toggle-edit").removeClass("active"),jQuery(window.xeditables).editable("disable"),window.cacie_edit_enabled=0,jQuery(CACIE_List_Selector).removeClass("cacie-enabled")}jQuery.fn.cacie_show_message=function(e,a){"undefined"==typeof a?a="":"info"!=a&&"error"!=a&&"success"!=a&&(a="");var t=jQuery("<div />");t.addClass("alert"),a&&t.addClass("alert-"+a),t.append('<button type="button" class="close" data-dismiss="alert">&times;</button>'),t.append(e),jQuery(this).after(t)},jQuery.fn.cacie_after_save=function(e,a,t){var i=jQuery(this);"undefined"!=typeof t&&i.cacie_set_value(e,a,t),i.removeClass("bg-transition"),i.cacie_handle_value(e,a),i.cacie_handle_actions(e,a),i.cacie_remove_ajax_loading(e,a),jQuery(document).trigger("cacie_after_save",e,a,t)},jQuery.fn.cacie_handle_value=function(e,a){var t,i=jQuery(this),c=i.cacie_get_value(e,a);t=c?!1:!0,"media"==e.addon_cacie.editable.type&&"false"==c&&(t=!0),t?(i.parents("td").removeClass("cacie-nonempty"),i.parents("td").addClass("cacie-empty")):(i.parents("td").addClass("cacie-nonempty"),i.parents("td").removeClass("cacie-empty"))},jQuery.fn.cacie_add_ajax_loading=function(e,a){var t=jQuery(this),i=t.parents("td").find(".cacie-editable");switch(e.type){case"title":case"name":i.siblings(".post-state").length&&(i=i.siblings(".post-state").eq(0))}i.after('<div class="spinner cacie-ajax-loading" />')},jQuery.fn.cacie_remove_ajax_loading=function(e,a){var t=jQuery(this);t.parents("td").find(".cacie-ajax-loading").remove()},jQuery.fn.cacie_restore_revision=function(e,a,t){var i=jQuery(this);a.columndata[e.column_name].current_revision=t;var c=CACIE_Items[a.ID].columndata[e.column_name].revisions,n=CACIE_Items[a.ID].columndata[e.column_name].current_revision;if("is_xeditable"in e.addon_cacie.editable&&e.addon_cacie.editable.is_xeditable){var d=i.cacie_get_target(e);i.cacie_add_ajax_loading(e,a),d.editable("setValue",c[n],!0),d.editable("submit")}else i.cacie_savecolumn(e,a,c[n],!1);i.cacie_handle_actions(e,a)},jQuery.fn.cacie_get_target=function(e){var a=jQuery(this);return"undefined"!=typeof e.addon_cacie.editable.js&&"undefined"!=typeof e.addon_cacie.editable.js.selector&&a.find(e.addon_cacie.editable.js.selector).length&&(a=a.find(e.addon_cacie.editable.js.selector)),a},jQuery.fn.cacie_get_value=function(e,a){return a.columndata[e.column_name].value},jQuery.fn.cacie_set_value=function(e,a,t){a.columndata[e.column_name].value=t},jQuery.fn.cacie_edit_text=function(e,a){var t=jQuery(this);t.cacie_xeditable({type:"text",value:t.cacie_get_value(e,a)},e,a)},jQuery.fn.cacie_edit_float=function(e,a){var t=jQuery(this);t.cacie_xeditable({type:"text",value:t.cacie_get_value(e,a),validate:function(e){return cacie_is_float(e)?void 0:qie_i18n.errors.invalid_float}},e,a)},jQuery.fn.cacie_edit_wc_price=function(e,a){var t=jQuery(this);t.cacie_xeditable({type:"wc_price",value:t.cacie_get_value(e,a)},e,a)},jQuery.fn.cacie_edit_wc_usage=function(e,a){var t=jQuery(this);t.cacie_xeditable({type:"wc_usage",value:t.cacie_get_value(e,a)},e,a)},jQuery.fn.cacie_edit_wc_stock=function(e,a){var t=jQuery(this);t.cacie_xeditable({type:"wc_stock",value:t.cacie_get_value(e,a)},e,a)},jQuery.fn.cacie_edit_dimensions=function(e,a){var t=jQuery(this);t.cacie_xeditable({type:"dimensions",value:t.cacie_get_value(e,a),validate:function(e){return cacie_is_float(e.length)&&cacie_is_float(e.width)&&cacie_is_float(e.height)?void 0:qie_i18n.errors.invalid_floats}},e,a)},jQuery.fn.cacie_edit_number=function(e,a){var t=jQuery(this);t.cacie_xeditable({type:"number",value:t.cacie_get_value(e,a)},e,a)},jQuery.fn.cacie_edit_password=function(e,a){var t=jQuery(this);t.cacie_xeditable({type:"password",value:t.cacie_get_value(e,a)},e,a)},jQuery.fn.cacie_edit_email=function(e,a){var t=jQuery(this);t.cacie_xeditable({type:"email",value:t.cacie_get_value(e,a)},e,a)},jQuery.fn.cacie_edit_checkboxlist=function(e,a){var t=jQuery(this);t.cacie_xeditable({type:"checklist"},e,a)},jQuery.fn.cacie_edit_textarea=function(e,a){var t=jQuery(this);t.cacie_xeditable({type:"textarea",value:t.cacie_get_value(e,a)},e,a)},jQuery.fn.cacie_edit_select=function(e,a){var t=jQuery(this),i=t.cacie_get_value(e,a),c=e.addon_cacie.editable.options;t.cacie_xeditable({type:"select",value:i,source:cacie_options_format_editable(c)},e,a)},jQuery.fn.cacie_edit_select2_dropdown=function(e,a){var t=e.addon_cacie.editable.options,i=jQuery(this),c={type:"select2",showbuttons:!1,source:cacie_options_format_editable(t),select2:{width:200}},n=a.columndata[e.column_name].editable;"undefined"!=typeof e.addon_cacie.editable.ajax_populate&&e.addon_cacie.editable.ajax_populate&&(args={source:"",select2:{width:200,minimumInputLength:1,initSelection:function(e,a){var t=[];if("undefined"!=typeof n.formattedvalue)for(var i in n.formattedvalue)t.push({id:i,text:n.formattedvalue[i]});1==t.length?a(t[0]):t.length>0&&a(t)},ajax:{url:ajaxurl,dataType:"json",quietMillis:100,data:function(t,i){return{plugin_id:"cpac",action:"cacie_get_options",searchterm:t,column:e.column_name,storage_model:CACIE_Storage_Model,item_id:a.ID}},results:function(e,a){return e.success?{results:cacie_options_format_editable(e.data)}:(i.data("editable").input.$input.select2("close"),i.data("editable").container.$form.editableform("error",e.data),{results:[]})}}}},c=jQuery.extend(c,args)),"undefined"!=typeof e.addon_cacie.editable.multiple&&e.addon_cacie.editable.multiple&&(c.select2.multiple=!0),jQuery(this).cacie_xeditable(c,e,a),"undefined"!=typeof e.addon_cacie.editable.ajax_populate&&e.addon_cacie.editable.ajax_populate&&jQuery(this).on("shown",function(){var e=i.data("editable").input.$input;e.on("change",function(){n.formattedvalue=[];var a=e.select2("data");if("undefined"!=typeof a.id)n.formattedvalue[a.id]=a.text;else for(var t in a)n.formattedvalue[a[t].id]=a[t].text})})},jQuery.fn.cacie_edit_select2_tags=function(e,a){var t=jQuery(this),i=e.addon_cacie.editable.options,c=t.cacie_get_value(e,a);"false"==c&&(c=""),t.cacie_xeditable({type:"select2",value:c,select2:{width:200,tags:cacie_options_format_editable(i)}},e,a)},jQuery.fn.cacie_edit_togglable=function(e,a){var t=jQuery(this),i=e.addon_cacie.editable.options;jQuery(this).on("click",function(){if(window.cacie_edit_enabled&&i){var c,n=t.cacie_get_value(e,a),d=i.length,o=0;for(var l in i)if(n==i[l].label){o=i[l].value;break}if("undefined"!=typeof e.addon_cacie.editable.required&&e.addon_cacie.editable.required&&0!==o)return void t.cacie_show_message(qie_i18n.errors.field_required);c=i[(o+1)%d].label,t.cacie_savecolumn(e,a,c)}})},jQuery.fn.cacie_edit_media=function(e,a){var t=jQuery(this);t.cacie_edit_attachment(e,a)},jQuery.fn.cacie_edit_attachment=function(e,a){var t=jQuery(this);t.on("click",function(i){if(i.preventDefault(),window.cacie_edit_enabled){var c=t.cacie_get_value(e,a);jQuery.isArray(c)||(c=[c]);var n={title:"Change image",button:{text:"Set as image"},multiple:"undefined"!=typeof e.addon_cacie.editable.multiple&&e.addon_cacie.editable.multiple};"undefined"!=typeof e.addon_cacie.editable.attachment&&"undefined"!=typeof e.addon_cacie.editable.attachment.library&&(n.library={},"undefined"!=typeof e.addon_cacie.editable.attachment.library.uploaded_to_post&&(n.library.uploadedTo=a.ID),"undefined"!=typeof e.addon_cacie.editable.attachment.library.type&&(n.library.type=e.addon_cacie.editable.attachment.library.type)),"js"in e.addon_cacie.editable&&(n=jQuery.extend(n,e.addon_cacie.editable.js));var d=wp.media(n);d.on("open",function(){var e=d.state().get("selection");c.forEach(function(a){attachment=wp.media.attachment(a),attachment.fetch(),e.add(attachment?[attachment]:[])})}),d.on("select",function(){var i=d.state().get("selection").toJSON(),c=d.options.multiple,n=[];for(var o in i){var l=i[o];n.push(l.id)}1!==n.length||c||(n=n[0]),t.cacie_savecolumn(e,a,n)}),"undefined"!=typeof e.addon_cacie.editable.attachment&&"undefined"!=typeof e.addon_cacie.editable.attachment.disable_select_current&&e.addon_cacie.editable.attachment.disable_select_current&&d.on("ready",function(){setTimeout(function(){},1)}),d.open()}})},jQuery.fn.cacie_edit_date=function(e,a){var t=jQuery(this),i=t.cacie_get_value(e,a);i&&(i=[i.slice(0,4),"-",i.slice(4)].join(""),i=[i.slice(0,7),"-",i.slice(7)].join("")),t.attr("data-date",i),t.attr("data-date-format","yyyy-mm-dd"),t.bdatepicker().on("changeDate",function(i){var c=new Date(i.date),n=c.yyyymmdd();t.cacie_savecolumn(e,a,n)}),Date.prototype.yyyymmdd=function(){var e=this.getFullYear().toString(),a=(this.getMonth()+1).toString(),t=this.getDate().toString();return e+(a[1]?a:"0"+a[0])+(t[1]?t:"0"+t[0])}},jQuery.fn.cacie_edit_combodate=function(e,a){var t=jQuery(this);jQuery(this).on("click",null,function(){if(window.cacie_edit_enabled){{t.cacie_get_value(e,a),e.date_save_format}t.bdatepicker()}})},jQuery.fn.cacie_edit_checklist=function(e,a){var t=jQuery(this),i=t.cacie_get_value(e,a),c=e.addon_cacie.editable.options;"false"==i&&(i=""),t.cacie_xeditable({type:"checklist",value:i,source:cacie_options_format_editable(c)},e,a)},jQuery.fn.cacie_xeditable=function(e,a,t){var i=jQuery(this),c={url:ajaxurl,params:{plugin_id:"cpac",action:"cacie_column_save",storage_model:CACIE_Storage_Model,column:a.column_name},pk:t.ID,value:jQuery(this).cacie_get_value(a,t),placement:"bottom",mode:"popup",emptytext:""};e=jQuery.extend(c,e),"undefined"!=typeof a.addon_cacie.editable.js&&(e=jQuery.extend(e,a.addon_cacie.editable.js)),"undefined"!=typeof a.addon_cacie.editable.placeholder&&(e.placeholder=a.addon_cacie.editable.placeholder);var n=[];if("undefined"!=typeof a.addon_cacie.editable.maxlength&&n.push({key:"maxlength",value:parseInt(a.addon_cacie.editable.maxlength,10)}),"undefined"!=typeof a.addon_cacie.editable.range_min&&n.push({key:"min",value:parseFloat(a.addon_cacie.editable.range_min,10)}),"undefined"!=typeof a.addon_cacie.editable.range_max&&n.push({key:"max",value:parseFloat(a.addon_cacie.editable.range_max,10)}),"undefined"!=typeof a.addon_cacie.editable.range_step){var d="any";a.addon_cacie.editable.range_step.length>0&&"any"!=a.addon_cacie.editable.range_step&&(d=parseFloat(a.addon_cacie.editable.range_step,10)),n.push({key:"step",value:d})}if(n.length){var o="";for(var l in n)o+=n[l].key+'="'+jQuery("<div />").text(n[l].value).html()+'"';switch(a.addon_cacie.editable.type){case"number":e.tpl='<input type="number" '+o+">";break;case"text":e.tpl='<input type="text" '+o+">";break;case"textarea":e.tpl="<textarea "+o+"></textarea>"}}"undefined"!=typeof a.addon_cacie.editable.required&&a.addon_cacie.editable.required&&(e.validate=function(e){var t=!0;switch(a.addon_cacie.editable.type){case"select":e&&"null"!=e||(t=!1);break;default:e.length||(t=!1)}return t?void 0:qie_i18n.errors.field_required});var r=i.cacie_get_target(a);r.on("save",function(e,c){i.cacie_store_revision(a,t,c.newValue),i.cacie_after_save(a,t,c.newValue)}),"undefined"==typeof a.addon_cacie.editable.display_ajax||a.addon_cacie.editable.display_ajax?(e.display=function(){},e.success=function(e){return e.success&&i.html(e.data.value),i.cacie_after_save(a,t),"undefined"!=typeof e.data&&"undefined"!=typeof e.data.rawvalue?{newValue:e.data.rawvalue}:void 0}):e.success=function(e){i.cacie_after_save(a,t)},a.addon_cacie.editable.is_xeditable=!0;var u=i;"undefined"!=typeof a.addon_cacie.editable.js&&"undefined"!=typeof a.addon_cacie.editable.js.selector&&(u=i.find(a.addon_cacie.editable.js.selector),i.removeClass("cacie-editable"),u.addClass("cacie-editable")),window.xeditables.push(u),i.editable(e)},jQuery.fn.cacie_store_revision=function(e,a,t){for(var i=CACIE_Items[a.ID].columndata[e.column_name].revisions,c=CACIE_Items[a.ID].columndata[e.column_name].current_revision,n=i.length-c-1,d=0;n>d;d++)CACIE_Items[a.ID].columndata[e.column_name].revisions.pop();CACIE_Items[a.ID].columndata[e.column_name].revisions.push(t),CACIE_Items[a.ID].columndata[e.column_name].current_revision++,jQuery(this).cacie_handle_actions(e,a)},jQuery.fn.cacie_savecolumn=function(e,a,t,i){var c=jQuery(this);c.cacie_set_value(e,a,t),c.addClass("bg-transition"),i="undefined"==typeof i||i,i&&jQuery(this).cacie_store_revision(e,a,t),c.cacie_add_ajax_loading(e,a),jQuery.post(ajaxurl,{plugin_id:"cpac",action:"cacie_column_save",storage_model:CACIE_Storage_Model,column:e.column_name,pk:a.ID,value:t},function(t){t.success&&(c.html(t.data.value),"undefined"!=typeof t.data.itemdata&&(a.columndata[e.column_name].itemdata=t.data.itemdata)),c.cacie_after_save(e,a)},"json")},jQuery.fn.cacie_handle_actions=function(e,a){var t,i,c,n,d,o;switch(t=jQuery(this),i=t.parent().find(".cacie-cell-actions"),i.remove(),t.parent().find(".cacie-edit, .cacie-undo, .cacie-redo, .cacie-clear").remove(),i=jQuery('<div class="cacie-cell-actions" />'),el_edit=jQuery('<a href="#" class="cacie-cell-action cacie-edit" title="'+qie_i18n.edit+'" />'),c=jQuery('<a href="#" class="cacie-cell-action cacie-undo" title="'+qie_i18n.undo+'" />'),n=jQuery('<a href="#" class="cacie-cell-action cacie-redo" title="'+qie_i18n.redo+'" />'),d=jQuery('<a href="#" class="cacie-cell-action cacie-clear" title="'+qie_i18n["delete"]+'"/>'),c.hide(),n.hide(),d.hide(),i.append(n),i.append(c),e.addon_cacie.editable.clear_button&&i.prepend(d),e.type){case"title":case"name":i.prepend(el_edit),t.parents("td").find(e.addon_cacie.editable.js.selector).after(i);break;case"coupon_code":i.prepend(el_edit),t.parents("td").find(e.addon_cacie.editable.js.selector).after(i),t.parents("td").find(".row-actions a").click(function(e){e.stopPropagation()});break;default:switch(e.addon_cacie.editable.type){case"attachment":a.columndata[e.column_name].itemdata.url&&(o=jQuery('<a href="'+a.columndata[e.column_name].itemdata.url+'" class="cacie-cell-action cacie-download" target="_blank" title="'+qie_i18n.download+'"/>'),i.prepend(o)),i.prepend(el_edit),t.parents("td").find(".cacie-editable").after(i);break;case"media":i.prepend(el_edit),c.before('<div class="cacie-separator" />'),n.before('<div class="cacie-separator" />'),"undefined"!=typeof e.addon_cacie.editable.multiple&&e.addon_cacie.editable.multiple?(t.parents("td").addClass("cacie-multiple"),d.remove(),t.parents("td").find(".cacie-item").each(function(){var i=jQuery('<div class="cacie-item-actions" />'),c=jQuery('<a href="#" class="cacie-cell-action cacie-delete" title="'+qie_i18n["delete"]+'"/>');i.append(c),c.on("click",function(e,a){return function(){var i=jQuery(this).parents(".cacie-item").attr("data-cacie-id"),c=t.cacie_get_value(e,a);return jQuery.isArray(c)&&(c=jQuery.grep(c,function(e){return e!=i})),t.cacie_savecolumn(e,a,c),!1}}(e,a)),jQuery(this).append(i)}),t.parents("td").find(".cacie-editable").append(i)):t.parents("td").find(".cacie-editable").append(i);break;default:i.prepend(el_edit),t.parents("td").find(".cacie-editable").after(i)}}el_edit.on("click",function(e,a){return function(a){a.preventDefault(),a.stopPropagation(),t.cacie_get_target(e).trigger("click")}}(e,a)),c.on("click",function(e,a){return function(i){i.preventDefault(),i.stopPropagation(),t.cacie_restore_revision(e,a,a.columndata[e.column_name].current_revision-1)}}(e,a)),n.on("click",function(e,a){return function(i){i.preventDefault(),i.stopPropagation(),t.cacie_restore_revision(e,a,a.columndata[e.column_name].current_revision+1)}}(e,a)),d.on("click",function(e,a){return function(i){t.cacie_savecolumn(e,a,""),i.stopPropagation()}}(e,a));var l=CACIE_Items[a.ID].columndata[e.column_name].revisions,r=CACIE_Items[a.ID].columndata[e.column_name].current_revision,u=l[r];r<l.length-1?n.show():n.hide(),r>0?c.show():c.hide(),u?d.show():d.hide()},jQuery(document).ready(function(e){"undefined"!=typeof CACIE_Columns&&"undefined"!=typeof CACIE_Items&&0!==CACIE_Columns.length&&0!==CACIE_Items.length&&(jQuery(".tablenav.top .actions:last").append('<a href="javascript:;" id="cacie-toggle-edit" class="add-new-h2">'+qie_i18n.inline_edit+"</a>"),e("#cacie-toggle-edit").on("click",function(e){window.cacie_edit_enabled?cacie_disable():cacie_enable(),jQuery.post(ajaxurl,{plugin_id:"cpac",action:"cacie_editability_state_save",value:window.cacie_edit_enabled,storage_model:CACIE_Storage_Model}),e.preventDefault()}),CACIE.inline_edit.active===!0&&cacie_enable())});